
PROG = crash-nfs

XSRC=mount.x nfs_prot.x
SRC=crash-nfs.c

GENSRCS=${XSRC:%.x=%_clnt.c} ${XSRC:%.x=%_xdr.c}
TIDY=${GENSRCS} ${XSRC:%.x=%.h} ${XSRC:%.x=%_svc.c}

OBJS=${SRC:%.c=%.o} ${GENSRCS:%.c=%.o}

# Compiler flags 

CFLAGS += -g 
LDLIBS += -lnsl
RPCGENFLAGS = 

# Targets 

all : $(PROG) 

%_xdr.c:%.x
	rpcgen $(RPCGENFLAGS) $<

%_clnt.c:%.x
	rpcgen $(RPCGENFLAGS) $<

${OBJS}: ${TIDY}

$(PROG) : ${OBJS} 
	$(CC) ${CFLAGS} ${LDFLAGS} -o $(PROG) ${OBJS} $(LDLIBS) 


clean:
	 $(RM) core ${OBJS} ${TIDY} a.out *% *~ ${PROG}

